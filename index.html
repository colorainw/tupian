<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>随机图片</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: #f4f4f9;
      margin: 0;
      font-family: Arial, sans-serif;
    }
    .controls {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      gap: 10px;
    }
    #musicBtn {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: #007bff;
      color: #fff;
      cursor: pointer;
      transition: background 0.3s;
    }
    #musicBtn:hover {
      background: #0056b3;
    }
    #progressContainer {
      display: none;
      align-items: center;
      gap: 8px;
      width: 320px;
    }
    #progressBar {
      flex: 1;
    }
    #currentTime, #duration {
      min-width: 50px;
      font-size: 14px;
      text-align: center;
      color: #333;
    }
    .image-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      width: 80%;
      max-width: 1000px;
    }
    .image-container img {
      width: 100%;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.3s;
    }
    .image-container img:hover {
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <div class="controls">
    <button id="musicBtn">▶ 播放音乐</button>
    <div id="progressContainer">
      <span id="currentTime">00:00</span>
      <input type="range" id="progressBar" value="0" min="0" step="1">
      <span id="duration">00:00</span>
    </div>
  </div>
  <div class="image-container" id="imageContainer"></div>

  <script>
    const musicUrl = "https://acg-1305857515.cos.ap-beijing.myqcloud.com/Music.mp3"
    const musicBtn = document.getElementById("musicBtn")
    const progressContainer = document.getElementById("progressContainer")
    const progressBar = document.getElementById("progressBar")
    const currentTimeSpan = document.getElementById("currentTime")
    const durationSpan = document.getElementById("duration")
    let audio

    function formatTime(seconds) {
      const m = Math.floor(seconds / 60).toString().padStart(2, "0")
      const s = Math.floor(seconds % 60).toString().padStart(2, "0")
      return `${m}:${s}`
    }

    musicBtn.addEventListener("click", () => {
      if (!audio) {
        audio = new Audio(musicUrl)
        audio.addEventListener("loadedmetadata", () => {
          progressBar.max = Math.floor(audio.duration)
          durationSpan.textContent = formatTime(audio.duration)
        })
        audio.addEventListener("timeupdate", () => {
          progressBar.value = Math.floor(audio.currentTime)
          currentTimeSpan.textContent = formatTime(audio.currentTime)
        })
        progressBar.addEventListener("input", () => {
          audio.currentTime = progressBar.value
        })
      }
      if (audio.paused) {
        audio.play()
        musicBtn.textContent = "⏸ 暂停音乐"
        progressContainer.style.display = "flex"
      } else {
        audio.pause()
        musicBtn.textContent = "▶ 播放音乐"
        progressContainer.style.display = "none"
      }
    })

    const imageContainer = document.getElementById("imageContainer")
    function loadImages(count = 4) {
      imageContainer.innerHTML = ""
      for (let i = 0; i < count; i++) {
        const img = document.createElement("img")
        fetch("https://www.dmoe.cc/random.php")
          .then(res => res.blob())
          .then(blob => {
            const url = URL.createObjectURL(blob)
            img.src = url
            img.onclick = () => downloadImage(blob)
          })
        imageContainer.appendChild(img)
      }
    }

    function downloadImage(blob) {
      const url = URL.createObjectURL(blob)
      const a = document.createElement("a")
      a.href = url
      a.download = `image_${Date.now()}.jpg`
      document.body.appendChild(a)
      a.click()
      document.body.removeChild(a)
      URL.revokeObjectURL(url)
    }

    window.addEventListener("keydown", e => {
      if (e.key.toLowerCase() === "r") loadImages()
    })

    loadImages()
  </script>
</body>
</html>
